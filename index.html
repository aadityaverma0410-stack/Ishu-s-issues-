<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Didi</title>
    <style>
        :root {
            --vintage-red: #b32d2d;
            --overlay: rgba(0, 0, 0, 0.75);
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            background: #000;
        }

        /* Fixed Background for every screen */
        .fixed-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(var(--overlay), var(--overlay)), url('main_bg.jpg');
            background-size: cover;
            background-position: center;
            z-index: -1;
        }

        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            position: absolute;
            color: white;
            text-align: center;
        }

        .active { display: flex; }

        /* Flower Garden */
        .garden {
            position: fixed;
            bottom: 10px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            pointer-events: none;
            z-index: 10;
        }

        .flower {
            font-size: 2.5rem;
            transition: all 2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-origin: bottom;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.3));
        }

        /* Stages of Growth */
        body.stage-1 .flower { transform: scale(0.6) translateY(30px); opacity: 0.6; }
        body.stage-2 .flower { transform: scale(1.1) translateY(10px); opacity: 0.9; }
        body.stage-3 .flower { transform: scale(2.2) translateY(-10px); opacity: 1; filter: drop-shadow(0 0 15px gold); }

        /* Screen 1 */
        .heart-frame {
            border-radius: 50%;
            border: 5px solid white;
            width: 200px;
            height: 200px;
            object-fit: cover;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        /* Tic Tac Toe Grid */
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 90px);
            gap: 12px;
            margin: 25px 0;
        }
        .cell {
            width: 90px;
            height: 90px;
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            cursor: pointer;
        }

        /* Centered Apology Message */
        #apology-msg {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            max-width: 450px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--vintage-red);
            border-radius: 20px;
            box-shadow: 0 0 40px rgba(179, 45, 45, 0.5);
            z-index: 100;
            line-height: 1.6;
            animation: popIn 0.8s forwards;
        }

        @keyframes popIn {
            from { opacity: 0; transform: translate(-50%, -40%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        /* Buttons */
        button {
            background: var(--vintage-red);
            color: white;
            padding: 15px 35px;
            border-radius: 50px;
            border: none;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            font-size: 1rem;
            transition: 0.3s;
        }

        #no-btn { background: #444; }

        .fall {
            position: fixed; top: -50px; pointer-events: none;
            animation: fall linear forwards; font-size: 2.5rem; z-index: 200;
        }
        @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }
    </style>
</head>
<body class="stage-1">

    <div class="fixed-bg"></div>

    <div class="garden">
        <div class="flower">üå±</div><div class="flower">üå±</div><div class="flower">üå±</div>
        <div class="flower">üå±</div><div class="flower">üå±</div><div class="flower (mobile-hide)">üå±</div>
    </div>

    <div id="screen1" class="screen active">
        <img src="center_photo.jpg" class="heart-frame" alt="Didi">
        <button onclick="changeScreen(2)">Apology Button üòø</button>
    </div>

    <div id="screen2" class="screen">
        <h2 id="game-status">Defeat the AI to forgive me! üòº</h2>
        <div class="grid" id="board">
            <div class="cell" onclick="userMove(0)"></div><div class="cell" onclick="userMove(1)"></div><div class="cell" onclick="userMove(2)"></div>
            <div class="cell" onclick="userMove(3)"></div><div class="cell" onclick="userMove(4)"></div><div class="cell" onclick="userMove(5)"></div>
            <div class="cell" onclick="userMove(6)"></div><div class="cell" onclick="userMove(7)"></div><div class="cell" onclick="userMove(8)"></div>
        </div>
        <button id="reset-btn" onclick="resetBoard()" style="background:#333">Try Again üîÑ</button>

        <div id="apology-msg">
            didii I‚Äôm really sorry for how I‚Äôve been behaving lately. I know I keep ragebaiting you and acting immature. 
            You deserve better from me I promise I‚Äôll be more serious now and respect your feelings every time 
            Please forgive mee üòøüòøüíîüíîüíî
            <br><br>
            <button onclick="changeScreen(3)">Proceed ‚û°Ô∏è</button>
        </div>
    </div>

    <div id="screen3" class="screen">
        <h1 id="header-text">Will you forgive me?</h1>
        <div style="display: flex; flex-direction: column; gap: 20px;">
            <button onclick="finish('accepted')">apology accepted?</button>
            <button id="no-btn" onclick="finish('denied')">noo apology accepted</button>
        </div>
    </div>

    <audio id="audio" loop><source src="song1.mp3" type="audio/mpeg"></audio>

    <script>
        let gameState = ["","","","","","","","",""];
        let isGameActive = true;
        let noScale = 1.0;

        function changeScreen(num) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen' + num).classList.add('active');
            document.body.className = 'stage-' + num;
            
            // Transform flowers
            const flowers = document.querySelectorAll('.flower');
            flowers.forEach((f, i) => {
                if(num === 2) f.innerText = i % 2 === 0 ? "üåª" : "üå∑";
                if(num === 3) f.innerText = i % 2 === 0 ? "üåª" : "üå∑";
            });

            if(num === 2) document.getElementById('audio').play();
        }

        function userMove(i) {
            if(gameState[i] === "" && isGameActive) {
                gameState[i] = "X";
                document.getElementsByClassName('cell')[i].innerText = "X";
                if(!checkWinner("X") && isGameActive) setTimeout(aiMove, 500);
            }
        }

        function aiMove() {
            // Stronger AI: Win > Block > Center > Random
            let move = findWinningMove("O") || findWinningMove("X") || (gameState[4] === "" ? 4 : null) || getRandomMove();
            if(move !== null) {
                gameState[move] = "O";
                document.getElementsByClassName('cell')[move].innerText = "O";
                checkWinner("O");
            }
        }

        function findWinningMove(p) {
            const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            for(let l of lines) {
                let count = l.filter(i => gameState[i] === p).length;
                let empty = l.filter(i => gameState[i] === "");
                if(count === 2 && empty.length === 1) return empty[0];
            }
            return null;
        }

        function getRandomMove() {
            let empty = gameState.map((v,i) => v === "" ? i : null).filter(v => v !== null);
            return empty.length > 0 ? empty[Math.floor(Math.random()*empty.length)] : null;
        }

        function checkWinner(p) {
            const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            if(wins.some(w => w.every(i => gameState[i] === p))) {
                isGameActive = false;
                if(p === "X") {
                    document.getElementById('board').style.display = 'none';
                    document.getElementById('reset-btn').style.display = 'none';
                    document.getElementById('game-status').style.display = 'none';
                    document.getElementById('apology-msg').style.display = 'block';
                } else {
                    document.getElementById('game-status').innerText = "AI Won! Keep trying üòº";
                }
                return true;
            }
            if(!gameState.includes("")) { document.getElementById('game-status').innerText = "Draw! Try again. ü§ù"; isGameActive = false; }
            return false;
        }

        function resetBoard() {
            gameState = ["","","","","","","","",""]; isGameActive = true;
            document.getElementById('game-status').innerText = "Defeat the AI to forgive me! üòº";
            Array.from(document.getElementsByClassName('cell')).forEach(c => c.innerText = "");
        }

        function finish(type) {
            if(type === 'accepted') {
                document.getElementById('header-text').innerText = "thankyou bihari üò≠üôèüèª";
                document.querySelector('#screen3 div').style.display = 'none';
            } else {
                document.getElementById('header-text').innerText = "Plssssss PLSSS NAA";
                noScale -= 0.15; if(noScale < 0.2) noScale = 0.2;
                document.getElementById('no-btn').style.transform = `scale(${noScale})`;
                
                // Falling Heartbreak
                for(let i=0; i<15; i++) {
                    setTimeout(() => {
                        const e = document.createElement("div"); e.className = "fall";
                        e.innerText = Math.random() > 0.5 ? "üòî" : "üíî";
                        e.style.left = Math.random()*100+"vw";
                        e.style.animationDuration = (Math.random()*2+2)+"s";
                        document.body.appendChild(e);
                        setTimeout(() => e.remove(), 3000);
                    }, i*100);
                }
            }
        }
    </script>
</body>
</html>
